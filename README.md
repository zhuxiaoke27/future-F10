# F10掘金信息图生成器

F10掘金信息图生成器是一个基于网页的工具，用于自动生成包含公司数据的精美信息图表。该工具使用SVG技术生成高质量、可缩放的矢量图形，最终可导出为PNG格式。

## 项目架构

### 1. 前端界面层
- HTML结构：提供用户交互界面
- CSS样式：处理布局和美化
- 分区设计：左侧输入区域，右侧预览区域

### 2. 数据处理层
- Excel文件解析：使用SheetJS库读取Excel数据
- 数据验证：检查数据格式和有效性
- 数据转换：将表格数据转换为可视化格式

### 3. 可视化渲染层
- SVG动态生成：基于数据内容创建SVG元素
- 小票样式实现：顶部锯齿边缘效果和阴影增强
- 柱状图生成：第二列数据可视化
- 多层布局：内部小票区域与外部版权区域分离

### 4. 导出处理层
- SVG到PNG转换：通过Canvas实现格式转换
- 文件下载：生成可下载的PNG图像

## 数据处理流程

1. **数据输入**
   - 用户上传Excel文件
   - 系统将文件转换为二进制数据

2. **数据解析**
   - 使用XLSX库读取和解析Excel数据
   - 将工作表转换为JSON格式数据

3. **数据验证**
   - 检查数据是否为空
   - 验证列数是否符合要求（至少两列）

4. **动态高度计算**
   - 基于数据行数计算所需SVG高度
   - 确保所有数据完整显示

5. **数据可视化处理**
   - 第一列：显示为文本和公司logo占位符
   - 第二列：显示为柱状图+数值文本（数值型数据）
     - 柱状图宽度计算：根据选择的模板使用不同算法
     - 数值格式化：根据设置的小数位数进行格式化显示
   - 第三列：根据正负值显示不同颜色文本
   - 第四列及之后：直接显示原始文本

## 模块关系图

```
+---------------------+     +-------------------+     +--------------------+
|  用户界面层         |     |  数据处理层        |     |  可视化渲染层       |
|  - 输入表单         |---->|  - Excel解析      |---->|  - SVG生成         |
|  - 颜色选择器       |     |  - 数据验证        |     |  - 动态布局调整     |
|  - 预览区域         |     |  - 数据转换        |     |  - 样式应用        |
+---------------------+     +-------------------+     +--------------------+
                                                              |
                                                              v
                                                     +--------------------+
                                                     |  导出处理层         |
                                                     |  - Canvas渲染      |
                                                     |  - PNG转换         |
                                                     |  - 文件下载        |
                                                     +--------------------+
```

## 主要功能特点

- 自定义标题和副标题（支持特定文本应用渐变色，使用[[文本]]格式）
- 上传和展示主图片
- 从Excel文件导入公司数据
- 支持公司Logo数据的JSON格式导入
- 自动为第二列数据生成柱状图
  - 支持两种柱状图模板：默认模板和统一模板
  - 统一模板：柱状图宽度基于实际数据最大值计算，确保最大值柱子充满整个宽度
  - 第二列数值小数位数控制：支持0-3位小数位数设置，默认1位
- 精美的顶部锯齿小票样式设计（支持自定义锯齿大小）
- 对第三列数据根据正负值显示不同颜色
- 动态调整SVG高度以适应不同数据量
- 多行版权文案支持，布局更加美观
- 导出为高质量PNG图像
- 多种预设配色模板（默认、红色、蓝色、紫色）

## 使用方法

1. 打开`index.html`文件
2. 输入副标题（将显示在"F10掘金"下方）
3. 上传主图片（可选）
4. 上传Excel数据文件（必需）
5. 添加公司Logo数据（JSON格式，可选）
6. 选择配色模板或自定义颜色（可选）
7. 调整锯齿大小（可选）
8. 配置表格设置：
   - 选择第二列柱状图模板（默认模板或统一模板）
   - 调整第二列数值小数位数（0-3位，默认1位）
   - 设置最后一列字体大小
9. 输入版权文案（支持多行输入）
10. 点击"生成信息图"按钮
11. 查看生成的信息图并下载PNG保存结果

## Excel数据格式要求

上传的Excel文件应符合以下格式：

- 第一列：公司名称（将显示为文本并添加公司logo占位符）
- 第二列：关键数据（将显示为柱状图+数值文本）
- 第三列：变化率（根据正负值显示不同颜色）
- 第四列及之后：其他数据（直接显示为文本）

## 公司Logo数据格式

为了显示公司Logo，需要提供符合以下JSON格式的数据：

```json
[
  {
    "name": "公司名称",
    "code": "股票代码",
    "company_logo": "Logo图片URL"
  },
  ...
]
```

可以使用"填充示例数据"按钮来查看格式示例。

## 柱状图模板说明

### 默认模板
- 柱状图宽度基于全局maxAbsValue计算
- maxAbsValue取所有数值中绝对值的最大值，如果小于10则向上取整
- 适用于需要在多个数据集之间保持比例一致性的场景

### 统一模板
- 柱状图宽度基于当前数据集的实际最大绝对值(actualMaxAbsValue)计算
- 确保拥有最大绝对值的柱子能够充满整个可用宽度
- 提供更直观的视觉效果，突出数据间的相对差异
- 支持正负值的渐变色填充

### 第二列数值格式化
- 支持0-3位小数位数控制，默认为1位
- 使用toFixed()方法进行精确格式化
- 自动保留原有的百分号等格式符号
- 实时预览当前设置的小数位数

## 配色模板

目前支持以下预设配色模板：

1. **默认（蓝色系）**
   - 外层背景：#f5f5f5
   - 主题渐变：#0052cc → #4169E1
   - 行背景渐变：#f0f7ff → #ffffff

2. **红色系**
   - 外层背景：#902622
   - 主题渐变：#bd1803 → #cb2914
   - 行背景渐变：#fee8e8 → #f8f2f2

3. **蓝色系**
   - 外层背景：#24439a
   - 主题渐变：#1e3dba → #0f41d8
   - 行背景渐变：#e8f0fe → #f3f5f9

4. **紫色系**
   - 外层背景：#2b0b52
   - 主题渐变：#7520be → #64149e
   - 行背景渐变：#ebdff0 → #fcf8fe

## 技术实现细节

- **SVG生成**: 使用原生JavaScript DOM API动态创建SVG元素
- **顶部锯齿边缘**: 使用SVG路径(path)绘制小票样式顶部锯齿效果，支持自定义锯齿大小
- **阴影效果**: 通过SVG过滤器实现小票的立体阴影
- **动态高度**: 根据数据行数计算并调整SVG总高度
- **柱状图比例**: 
  - 默认模板：基于全局maxAbsValue计算柱状图宽度
  - 统一模板：基于实际数据最大绝对值(actualMaxAbsValue)计算，确保最大值柱子充满整个宽度
- **数值格式化**: 使用toFixed()方法控制第二列数值的小数位数显示，支持0-3位设置
- **颜色处理**: 第三列根据数值正负显示不同颜色
- **多行文本支持**: 版权文案支持换行显示，自动计算布局
- **布局优化**: 内外区域分离，确保视觉美观
- **PNG导出**: 使用Canvas API将SVG渲染为PNG格式
- **配色模板系统**: 提供多种预设配色方案，支持自定义颜色

## 垂直组件链式关系

### 账号Logo区域
- 位置: headerY = padding + 60
- 高度: headerHeight = 60
- Logo的Y坐标: headerY - 10（稍微上移）
- Logo高度: 80px

### 主标题/副标题区域
- 起始位置: titleY = headerY + headerHeight + 160
- 区域高度: titleHeight = 130
- 主标题Y坐标: titleY
- 副标题Y坐标: titleY + 125（主标题下方，字体大小相同为130px）

### 图片区域
- 起始位置: imageY = titleY + titleHeight + 20
- 高度: imageHeight = 450
- 图片宽度: imageWidth = innerWidth - 60

### 装饰线
- 位置: decorativeLineY = imageY + imageHeight + 40

### 表头区域
- 起始位置: tableHeaderY = decorativeLineY + 40（基于装饰线位置）
- 高度: tableHeaderHeight = 50
- 表头文字Y坐标: tableHeaderY + 30

### 数据表格区域
- 起始位置: dataY = tableHeaderY + 70
- 行高: rowHeight = 88px
- 行间距: rowSpacing = 10px
- 总高度: dataTableHeight = (excelData.length * (rowHeight + rowSpacing)) - rowSpacing + 30

### 版权区域
- 外部版权文案Y坐标: copyrightY_outside = ticketBottomY + 40（小票底部下方40px）

## 添加新配色模板

要添加新的配色模板，需要按照以下步骤操作：

1. 在JavaScript中定义新模板：
   - 打开script.js文件
   - 在colorTemplates对象中添加新模板定义，包括5个关键颜色值：
   ```javascript
   const colorTemplates = {
       // 现有模板...
       
       // 添加新模板，例如"绿色"模板
       green: {
           outerBg: '#1a5d1a',       // 外层背景颜色
           gradientDeep: '#2e8b2e',  // 主题渐变深色
           gradientLight: '#52b152', // 主题渐变浅色
           rowBgDeep: '#e8f5e8',     // 行背景渐变深色
           rowBgLight: '#f7fff7'     // 行背景渐变浅色
       }
   };
   ```

2. 在HTML中添加新模板按钮：
   - 打开index.html文件
   - 在模板选择区域添加新按钮：
   ```html
   <button type="button" class="template-btn" data-template="green">
       <div class="template-preview green-preview"></div>
       <span>绿色</span>
   </button>
   ```

3. 添加预览样式：
   - 在HTML的`<style>`标签中或CSS文件中添加新模板的预览样式：
   ```css
   .green-preview {
       background-color: #1a5d1a;
       --deep-color: #2e8b2e;
       --light-color: #52b152;
       --row-deep: #e8f5e8;
       --row-light: #f7fff7;
   }
   ```

## 注意事项

- 建议使用最新版Chrome、Firefox或Edge浏览器
- Excel文件应为.xlsx或.xls格式
- 为获得最佳效果，建议上传的图片分辨率不低于1200×600像素
- 账号Logo已内置在项目中（logo_button.png）
- 导出PNG过程中可能需要较大内存，特别是数据量大的情况# Hadoop
